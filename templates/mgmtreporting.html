<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ report_title }} - {{ primary_market_area }}</title>
    <style>
        /* --- Embedded Tailwind CSS --- */
        {{ css_content | safe }}

        /* --- Custom Styles & Typography --- */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            color: #0a0a0a;
        }

        /* Override for h1 text transform and wrapping */
        h1 {
            text-transform: none !important;
            white-space: nowrap; /* Prevent text from wrapping */
            /* Removed overflow: hidden; and text-overflow: ellipsis; to prevent truncation */
        }

        /* --- Design Principle 1: Accent Color (Orange) --- */
        .accent-bg { background-color: #ff6b00; }
        .accent-text { color: #ff6b00; }
        .accent-border { border-color: #ff6b00; }

        /* --- Visual Hierarchy & Negative Space --- */
        .kpi-card {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }
        .kpi-card:hover {
            transform: translateY(-4px);
        }

        /* Financial Table Styling */
        .financial-table th, .financial-table td {
            padding: 10px 0;
            font-size: 0.95rem;
        }
        .financial-table th {
            text-align: left;
            font-weight: 600;
            color: #ff6b00;
            border-bottom: 2px solid #e5e7eb;
        }
        .financial-table .data-row {
            border-bottom: 1px solid #f3f4f6;
        }
    </style>
</head>
<body>

    <!-- ============================================== -->
    <!-- SECTION 1: Cover Page (The Hook) -->
    <!-- ============================================== -->
    <header class="h-screen w-full relative overflow-hidden flex items-center justify-center">
        {% if hero_image_base64 %}
        <img
            src="data:image/png;base64,{{ hero_image_base64 }}"
            class="absolute inset-0 w-full h-full object-cover"
            alt="Hero-Bild des primären Marktgebiets."
        >
        {% endif %}
        <div class="absolute inset-0 bg-black opacity-60"></div>
        <div class="relative z-10 text-white text-center p-8"> <!-- Removed max-w-4xl -->
            {% if logo_base64 %}
            <img src="data:image/png;base64,{{ logo_base64 }}" alt="Logo" class="mx-auto mb-8 h-48">
            {% endif %}
            <h1 class="text-6xl font-extrabold mb-4 uppercase tracking-tighter">{{ report_title | default('Executive Immobilienmarktbericht') }}</h1>
            <h2 class="text-4xl font-light mb-6">{{ primary_market_area | default('Metropolregion, Q4 2025') }}</h2>
            <div class="border-t-4 accent-border inline-block pt-3">
                <p class="text-xl font-medium">{{ date_range }}</p>
            </div>
        </div>
    </header>

    <!-- ============================================== -->
    <!-- SECTION 2: Executive Summary & KPIs (The Quick Read) -->
    <!-- ============================================== -->
    <section class="py-20 px-8 lg:px-20 bg-white">
        <h2 class="text-4xl font-bold mb-12 accent-text border-b pb-4 border-gray-200">2. Zusammenfassung \& Leistungskennzahlen (KPIs)</h2>
        <div class="grid lg:grid-cols-3 gap-12">
            <div class="lg:col-span-2">
                <blockquote class="text-3xl font-light italic leading-relaxed mb-8 p-4 border-l-8 accent-border bg-gray-50 text-gray-700">
                    "{{ blockquote }}"
                </blockquote>
                <p class="text-lg leading-relaxed text-gray-700">
                    {{ executivesummary }}
                </p>
            </div>
            <div class="lg:col-span-1 space-y-6">
                <div class="kpi-card bg-white p-6 rounded-xl border-t-4 accent-border">
                    <p class="text-sm font-semibold uppercase text-gray-500 mb-1">Gesamtverkaufsvolumen</p>
                    <h3 class="text-4xl font-extrabold accent-text">{{ total_sales_volume | default('CHF 1.2 Mrd.') }}</h3>
                    <p class="text-sm text-gray-600 mt-2">Bruttowert aller abgeschlossenen Transaktionen im Markt.</p>
                </div>
                <div class="kpi-card bg-white p-6 rounded-xl border-t-4 accent-border">
                    <p class="text-sm font-semibold uppercase text-gray-500 mb-1">J-O-J Volumenänderung</p>
                    <h3 class="text-4xl font-extrabold text-green-600">{{ volume_yoy_change | default('+18.5%') }}</h3>
                    <p class="text-sm text-gray-600 mt-2">Stärkstes Q4-Wachstum seit fünf Jahren.</p>
                </div>
                <div class="kpi-card bg-white p-6 rounded-xl border-t-4 accent-border">
                    <p class="text-sm font-semibold uppercase text-gray-500 mb-1">Durchschnittspreis/m²</p>
                    <h3 class="text-4xl font-extrabold accent-text">{{ avg_price_per_sqft | default('CHF 1,850') }}</h3>
                    <p class="text-sm text-gray-600 mt-2">Schlüsselindikator für Marktgesundheit und Bewertungsstabilität.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- ============================================== -->
    <!-- NEW SECTION 3: Portfolio Financial Statements (BS/P&L) -->
    <!-- ============================================== -->
    <section class="py-20 px-8 lg:px-20 bg-gray-50">
        <h2 class="text-4xl font-bold mb-12 accent-text border-b pb-4 border-gray-300">3. Finanzberichte des Portfolios ({{ date_range }})</h2>
        <p class="text-lg text-gray-700 mb-10">Zusammenfassung der finanziellen Leistung und des Stands des verwalteten Immobilienportfolios.</p>
        <div class="grid lg:grid-cols-2 gap-10">
            <div>
                <h3 class="text-2xl font-bold mb-4 accent-text border-b pb-2">Erträge</h3>
                <table class="w-full financial-table">
                    <thead>
                        <tr>
                            <th>Beschreibung</th>
                            <th class="text-right">Betrag (CHF)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for key, value in ertraege.items() %}
                        <tr class="data-row">
                            <td>{{ key }}</td>
                            <td class="text-right">{{ value | currency }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <br>
                <h3 class="text-2xl font-bold mb-4 accent-text border-b pb-2">Aufwände</h3>
                <table class="w-full financial-table">
                    <thead>
                        <tr>
                            <th>Beschreibung</th>
                            <th class="text-right">Betrag (CHF)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for key, value in aufwand.items() %}
                        <tr class="data-row">
                            <td>{{ key }}</td>
                            <td class="text-right">{{ value | currency }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div>
                <h3 class="text-2xl font-bold mb-4 accent-text border-b pb-2">Aktiva</h3>
                <table class="w-full financial-table">
                    <thead>
                        <tr>
                            <th>Konto</th>
                            <th class="text-right">Betrag (CHF)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for key, value in aktiva.items() %}
                        <tr class="data-row">
                            <td>{{ key }}</td>
                            <td class="text-right">{{ value | currency }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <br>
                <h3 class="text-2xl font-bold mb-4 accent-text border-b pb-2">Passiva</h3>
                <table class="w-full financial-table">
                    <thead>
                        <tr>
                            <th>Konto</th>
                            <th class="text-right">Betrag (CHF)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for key, value in passiva.items() %}
                        <tr class="data-row">
                            <td>{{ key }}</td>
                            <td class="text-right">{{ value | currency }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- ============================================== -->
    <!-- SECTION 4: Waterfall Chart -->
    <!-- ============================================== -->
    <section class="py-20 px-8 lg:px-20 bg-white">
        <h2 class="text-4xl font-bold mb-12 accent-text border-b pb-4 border-gray-300">
            4. Detaillierte Finanzanalyse
        </h2>
        <div class="grid lg:grid-cols-3 gap-12">
            <div class="lg:col-span-2 bg-gray-100 p-8 rounded-xl shadow-inner">
                {{ waterfall_chart_html | safe }}
            </div>
            <div class="lg:col-span-1">
                <div class="bg-gray-50 p-6 rounded-xl border-t-4 accent-border">
                    <h3 class="text-xl font-bold mb-4 accent-text">Erläuterung zum Wasserfalldiagramm</h3>
                    <p class="text-sm text-gray-700 leading-relaxed">
                        {{ waterfall_explanation_html | default('Explanation of the waterfall chart will be generated here.') }}
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- ============================================== -->
    <!-- SECTION 6: Budget Proposal -->
    <!-- ============================================== -->
    <section class="py-20 px-8 lg:px-20 bg-gray-50">
        <h2 class="text-4xl font-bold mb-12 accent-text border-b pb-4 border-gray-300">
            6. Budgetvorschlag für das kommende Jahr
        </h2>
        <div class="prose max-w-none">
            {{ budget_proposal_html | markdown | safe }}
        </div>
    </section>

    <!-- Footer for Report Integrity -->
    <footer class="py-6 px-8 lg:px-20 accent-bg text-white text-center">
        <p class="text-sm">&copy; {{ current_year }} Immobilienmanagement. Vertraulicher Executive Report.</p>
    </footer>

</body>
</html>